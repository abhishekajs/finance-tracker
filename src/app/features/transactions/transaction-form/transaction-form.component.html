<div class="transaction-form-dialog">
  <h2 mat-dialog-title>{{ dialogTitle }}</h2>

  <mat-dialog-content>
    <form
      [formGroup]="transactionForm"
      class="transaction-form"
      (ngSubmit)="onSubmit()"
      (input)="onFormChange()"
    >
      <!-- Amount -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Amount</mat-label>
        <input
          matInput
          type="number"
          formControlName="amount"
          placeholder="0.00"
          step="0.01"
        />
        <span matTextPrefix>₹&nbsp;</span>
        <mat-icon matSuffix>account_balance_wallet</mat-icon>
        <mat-error *ngIf="transactionForm.get('amount')?.hasError('required')">
          Amount is required
        </mat-error>
        <mat-error *ngIf="transactionForm.get('amount')?.hasError('min')">
          Amount must be greater than 0
        </mat-error>
      </mat-form-field>

      <!-- Description -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description</mat-label>
        <input
          matInput
          formControlName="description"
          placeholder="e.g., Grocery Shopping"
        />
        <mat-icon matSuffix>description</mat-icon>
        <mat-error
          *ngIf="transactionForm.get('description')?.hasError('required')"
        >
          Description is required
        </mat-error>
        <mat-error
          *ngIf="transactionForm.get('description')?.hasError('minlength')"
        >
          Description must be at least 2 characters
        </mat-error>
      </mat-form-field>

      <!-- Transaction Type -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Transaction Type</mat-label>
        <mat-select formControlName="type">
          <mat-option *ngFor="let type of transactionTypes" [value]="type">
            {{ getTransactionTypeLabel(type) }}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>category</mat-icon>
        <mat-error *ngIf="transactionForm.get('type')?.hasError('required')">
          Transaction type is required
        </mat-error>
      </mat-form-field>

      <!-- Account -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Account</mat-label>
        <mat-select formControlName="accountId">
          <mat-option *ngFor="let account of accounts" [value]="account.id">
            <div class="account-option">
              {{ account.name }} (₹{{ account.balance | number: '1.2-2' }})
            </div>
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>account_balance</mat-icon>
        <mat-error
          *ngIf="transactionForm.get('accountId')?.hasError('required')"
        >
          Account is required
        </mat-error>
      </mat-form-field>

      <!-- Category -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Category (Optional)</mat-label>
        <mat-select formControlName="categoryId">
          <mat-select-trigger>
            <div
              class="selected-category"
              *ngIf="transactionForm.get('categoryId')?.value"
            >
              <mat-icon [style.color]="getSelectedCategoryColor()">
                {{ getSelectedCategoryIcon() }}
              </mat-icon>
              <span>{{ getSelectedCategoryName() }}</span>
            </div>
            <span *ngIf="!transactionForm.get('categoryId')?.value">
              <em>No Category</em>
            </span>
          </mat-select-trigger>
          <mat-option value="">
            <em>No Category</em>
          </mat-option>
          <mat-option *ngFor="let category of categories" [value]="category.id">
            <div class="category-option">
              <mat-icon [style.color]="category.color">{{
                category.icon
              }}</mat-icon>
              <span>{{ category.name }}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>label</mat-icon>
      </mat-form-field>

      <!-- Date -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Date</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="date" />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="transactionForm.get('date')?.hasError('required')">
          Date is required
        </mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>

  <div class="error-message" *ngIf="errorMessage">
    <mat-icon>error</mat-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="onCancel()" [disabled]="loading">Cancel</button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="!transactionForm.valid || loading"
    >
      <mat-icon *ngIf="loading">hourglass_empty</mat-icon>
      <mat-icon *ngIf="!loading">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      {{ isEditMode ? 'Update' : 'Create' }} Transaction
    </button>
  </mat-dialog-actions>
</div>
